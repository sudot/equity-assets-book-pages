import{g as ye,Q as be}from"./user.05856cac.js";import{ac as _e,ad as x,G as ke,ae as Se,af as V,ag as N,aj as Z,P as U,ak as j,r as F,e as w,w as le,k as ue,a1 as we,j as A,T as Pe,b2 as Ce,A as R,b3 as Ae,c as L,a9 as Te,aa as Qe,b4 as xe,m as de,_ as ce,q as _,s as E,t as d,v as o,av as G,a4 as c,Q as P,au as pe,ay as H,at as me,az as qe,n as De,ap as $e,L as Ve,E as Ie,aZ as Ee,p as J,a3 as Le,a5 as y,x as C,ax as ee,y as M,F as I,as as z,a2 as Be,aw as Ne}from"./index.757f950f.js";import{j as Ue,h as je,Q as Me}from"./QForm.c5e622cc.js";import{c as ze,b as Fe,d as Ge,Q as Re,a as te}from"./ClosePopup.13d91716.js";import{Q as Ke}from"./QItem.1baa897c.js";import{Q as Oe}from"./QList.bd4e087b.js";import{g as se,s as ae}from"./touch.70a9dd44.js";import{b as We,Q as Xe,a as ne}from"./transaction.804e5840.js";import{u as Ye,a as Ze,b as He,Q as Je}from"./QTabs.5e4c613e.js";import{u as et,a as tt}from"./QResizeObserver.d4fbc71d.js";import{Q as st}from"./QPage.6a266ce5.js";import{s as at,A as nt,f as ot,d as it}from"./AddTransaction.b0e9a5b8.js";import{u as rt}from"./use-quasar.23119b98.js";import"./rtl.b51694b1.js";import"./decimal.cf065309.js";function lt(e){const s=[.06,6,50];return typeof e=="string"&&e.length&&e.split(":").forEach((m,l)=>{const u=parseFloat(m);u&&(s[l]=u)}),s}var ut=_e({name:"touch-swipe",beforeMount(e,{value:s,arg:m,modifiers:l}){if(l.mouse!==!0&&x.has.touch!==!0)return;const u=l.mouseCapture===!0?"Capture":"",t={handler:s,sensitivity:lt(m),direction:se(l),noop:ke,mouseStart(a){ae(a,t)&&Se(a)&&(V(t,"temp",[[document,"mousemove","move",`notPassive${u}`],[document,"mouseup","end","notPassiveCapture"]]),t.start(a,!0))},touchStart(a){if(ae(a,t)){const f=a.target;V(t,"temp",[[f,"touchmove","move","notPassiveCapture"],[f,"touchcancel","end","notPassiveCapture"],[f,"touchend","end","notPassiveCapture"]]),t.start(a)}},start(a,f){x.is.firefox===!0&&N(e,!0);const n=Z(a);t.event={x:n.left,y:n.top,time:Date.now(),mouse:f===!0,dir:!1}},move(a){if(t.event===void 0)return;if(t.event.dir!==!1){U(a);return}const f=Date.now()-t.event.time;if(f===0)return;const n=Z(a),r=n.left-t.event.x,v=Math.abs(r),g=n.top-t.event.y,p=Math.abs(g);if(t.event.mouse!==!0){if(v<t.sensitivity[1]&&p<t.sensitivity[1]){t.end(a);return}}else if(v<t.sensitivity[2]&&p<t.sensitivity[2])return;const k=v/f,b=p/f;t.direction.vertical===!0&&v<p&&v<100&&b>t.sensitivity[0]&&(t.event.dir=g<0?"up":"down"),t.direction.horizontal===!0&&v>p&&p<100&&k>t.sensitivity[0]&&(t.event.dir=r<0?"left":"right"),t.direction.up===!0&&v<p&&g<0&&v<100&&b>t.sensitivity[0]&&(t.event.dir="up"),t.direction.down===!0&&v<p&&g>0&&v<100&&b>t.sensitivity[0]&&(t.event.dir="down"),t.direction.left===!0&&v>p&&r<0&&p<100&&k>t.sensitivity[0]&&(t.event.dir="left"),t.direction.right===!0&&v>p&&r>0&&p<100&&k>t.sensitivity[0]&&(t.event.dir="right"),t.event.dir!==!1?(U(a),t.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),ze(),t.styleCleanup=q=>{t.styleCleanup=void 0,document.body.classList.remove("non-selectable");const T=()=>{document.body.classList.remove("no-pointer-events--children")};q===!0?setTimeout(T,50):T()}),t.handler({evt:a,touch:t.event.mouse!==!0,mouse:t.event.mouse,direction:t.event.dir,duration:f,distance:{x:v,y:p}})):t.end(a)},end(a){t.event!==void 0&&(j(t,"temp"),x.is.firefox===!0&&N(e,!1),t.styleCleanup!==void 0&&t.styleCleanup(!0),a!==void 0&&t.event.dir!==!1&&U(a),t.event=void 0)}};if(e.__qtouchswipe=t,l.mouse===!0){const a=l.mouseCapture===!0||l.mousecapture===!0?"Capture":"";V(t,"main",[[e,"mousedown","mouseStart",`passive${a}`]])}x.has.touch===!0&&V(t,"main",[[e,"touchstart","touchStart",`passive${l.capture===!0?"Capture":""}`],[e,"touchmove","noop","notPassiveCapture"]])},updated(e,s){const m=e.__qtouchswipe;m!==void 0&&(s.oldValue!==s.value&&(typeof s.value!="function"&&m.end(),m.handler=s.value),m.direction=se(s.modifiers))},beforeUnmount(e){const s=e.__qtouchswipe;s!==void 0&&(j(s,"main"),j(s,"temp"),x.is.firefox===!0&&N(e,!1),s.styleCleanup!==void 0&&s.styleCleanup(),delete e.__qtouchswipe)}});const dt={name:{required:!0},disable:Boolean},oe={setup(e,{slots:s}){return()=>A("div",{class:"q-panel scroll",role:"tabpanel"},R(s.default))}},ct={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},pt=["update:modelValue","beforeTransition","transition"];function mt(){const{props:e,emit:s,proxy:m}=ue(),{getCacheWithFn:l}=Ue();let u,t;const a=F(null),f=F(null);function n(i){const h=e.vertical===!0?"up":"left";Q((m.$q.lang.rtl===!0?-1:1)*(i.direction===h?1:-1))}const r=w(()=>[[ut,n,void 0,{horizontal:e.vertical!==!0,vertical:e.vertical,mouse:!0}]]),v=w(()=>e.transitionPrev||`slide-${e.vertical===!0?"down":"right"}`),g=w(()=>e.transitionNext||`slide-${e.vertical===!0?"up":"left"}`),p=w(()=>`--q-transition-duration: ${e.transitionDuration}ms`),k=w(()=>typeof e.modelValue=="string"||typeof e.modelValue=="number"?e.modelValue:String(e.modelValue)),b=w(()=>({include:e.keepAliveInclude,exclude:e.keepAliveExclude,max:e.keepAliveMax})),q=w(()=>e.keepAliveInclude!==void 0||e.keepAliveExclude!==void 0);le(()=>e.modelValue,(i,h)=>{const S=D(i)===!0?B(i):-1;t!==!0&&W(S===-1?0:S<B(h)?-1:1),a.value!==S&&(a.value=S,s("beforeTransition",i,h),we(()=>{s("transition",i,h)}))});function T(){Q(1)}function K(){Q(-1)}function O(i){s("update:modelValue",i)}function D(i){return i!=null&&i!==""}function B(i){return u.findIndex(h=>h.props.name===i&&h.props.disable!==""&&h.props.disable!==!0)}function fe(){return u.filter(i=>i.props.disable!==""&&i.props.disable!==!0)}function W(i){const h=i!==0&&e.animated===!0&&a.value!==-1?"q-transition--"+(i===-1?v.value:g.value):null;f.value!==h&&(f.value=h)}function Q(i,h=a.value){let S=h+i;for(;S>-1&&S<u.length;){const $=u[S];if($!==void 0&&$.props.disable!==""&&$.props.disable!==!0){W(i),t=!0,s("update:modelValue",$.props.name),setTimeout(()=>{t=!1});return}S+=i}e.infinite===!0&&u.length>0&&h!==-1&&h!==u.length&&Q(i,i===-1?u.length:-1)}function X(){const i=B(e.modelValue);return a.value!==i&&(a.value=i),!0}function Y(){const i=D(e.modelValue)===!0&&X()&&u[a.value];return e.keepAlive===!0?[A(Ae,b.value,[A(q.value===!0?l(k.value,()=>({...oe,name:k.value})):oe,{key:k.value,style:p.value},()=>i)])]:[A("div",{class:"q-panel scroll",style:p.value,key:k.value,role:"tabpanel"},[i])]}function ve(){if(u.length!==0)return e.animated===!0?[A(Pe,{name:f.value},Y)]:Y()}function he(i){return u=Ce(R(i.default,[])).filter(h=>h.props!==null&&h.props.slot===void 0&&D(h.props.name)===!0),u.length}function ge(){return u}return Object.assign(m,{next:T,previous:K,goTo:O}),{panelIndex:a,panelDirectives:r,updatePanelsList:he,updatePanelIndex:X,getPanelContent:ve,getEnabledPanels:fe,getPanels:ge,isValidPanelName:D,keepAliveProps:b,needsUniqueKeepAliveWrapper:q,goToPanelByOffset:Q,goToPanel:O,nextPanel:T,previousPanel:K}}var ie=L({name:"QTabPanel",props:dt,setup(e,{slots:s}){return()=>A("div",{class:"q-tab-panel",role:"tabpanel"},R(s.default))}}),ft=L({name:"QTabPanels",props:{...ct,...Te},emits:pt,setup(e,{slots:s}){const m=ue(),l=Qe(e,m.proxy.$q),{updatePanelsList:u,getPanelContent:t,panelDirectives:a}=mt(),f=w(()=>"q-tab-panels q-panel-parent"+(l.value===!0?" q-tab-panels--dark q-dark":""));return()=>(u(s),xe("div",{class:f.value},t(),"pan",e.swipeable,()=>a.value))}}),re=L({name:"QTab",props:Ye,emits:Ze,setup(e,{slots:s,emit:m}){const{renderTab:l}=He(e,s,m);return()=>l("div")}}),vt=L({name:"QPageSticky",props:et,setup(e,{slots:s}){const{getStickyContent:m}=tt();return()=>m(s)}});const ht=de({name:"AddStock",props:{show:{type:Boolean,required:!0},data:{type:Object,required:!0}},emits:["update:show","confirm"],setup(e,s){const m=rt(),l={id:void 0,name:void 0,code:void 0,userId:void 0},u=F({...l});return le(()=>e.data,a=>{u.value={...l,...a}}),{formData:u,onSubmit:()=>{const a={...u.value};a.userId=+a.userId,at(a).then(()=>{s.emit("confirm"),s.emit("update:show",!1)}).catch(f=>{var n;m.notify({message:((n=f.response)==null?void 0:n.data)||f.message||"\u4FDD\u5B58\u5931\u8D25",color:"warning"})})}}}}),gt={class:"flex items-center justiry-end q-gutter-md"};function yt(e,s,m,l,u,t){return _(),E(qe,{"model-value":e.show,persistent:""},{default:d(()=>[o(me,{style:{width:"700px","max-width":"80vw"}},{default:d(()=>[o(Fe,{class:"shadow-2"},{default:d(()=>[o(Ge,null,{default:d(()=>[G("\u65B0\u589E\u6807\u7684")]),_:1}),c("div",gt,[o(P,{label:"\u5173\u95ED",onClick:s[0]||(s[0]=a=>e.$emit("update:show",!1))}),o(P,{color:"primary",label:"\u4FDD\u5B58",onClick:s[1]||(s[1]=a=>e.$refs.form.submit())})])]),_:1}),o(pe,{class:"q-pt-none"},{default:d(()=>[o(je,{ref:"form",greedy:"",onSubmit:e.onSubmit},{default:d(()=>[o(H,{filled:"",modelValue:e.formData.name,"onUpdate:modelValue":s[2]||(s[2]=a=>e.formData.name=a),label:"\u540D\u79F0 *","lazy-rules":"",rules:[a=>(a==null?void 0:a.length)>0||"\u540D\u79F0\u5FC5\u987B\u586B\u5199"]},null,8,["modelValue","rules"]),o(H,{filled:"",modelValue:e.formData.code,"onUpdate:modelValue":s[3]||(s[3]=a=>e.formData.code=a),label:"\u7F16\u7801 *","lazy-rules":"",rules:[a=>(a==null?void 0:a.length)>0||"\u7F16\u7801\u5FC5\u987B\u586B\u5199"]},null,8,["modelValue","rules"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["model-value"])}var bt=ce(ht,[["render",yt]]);const _t=de({name:"StockListPage",components:{AddStock:bt,AddTransaction:nt},setup(){const s=De().params.userId,m=$e(),l=Ve({activeTab:"sticks",user:{},stocks:[],transactionGroups:[],stockAddShow:!1,stockAddData:{},transactionAddShow:!1,transactionAddData:{}}),u=()=>{ot(s).then(r=>l.stocks=r.data),We(s).then(r=>{const v={},g=[];r.data.forEach((p,k)=>{let b=v[p.date];b||(b=[],g.push(p.date)),b.push(p),v[p.date]=b}),l.transactionGroups=g.map(p=>({date:p,transactions:v[p]}))})};Ie(()=>{ye(s).then(r=>l.user=r.data),u()});const t=w(()=>m.isLogin),a=r=>{l.transactionAddShow=!0,l.transactionAddData={stockId:r.id,userId:r.userId}},f=r=>{l.stockAddShow=!0,l.stockAddData={userId:s,...r}},n=r=>{it(r).then(u).catch(v=>{var g;$q.notify({message:((g=v.response)==null?void 0:g.data)||v.message||"\u6807\u7684\u5220\u9664\u5931\u8D25",color:"warning"})})};return{...Ee(l),isLogin:t,loadData:u,onAddTransaction:a,onEditStock:f,onDeleteStock:n}}}),kt={class:"row q-pa-md"},St={class:"col"},wt={class:"text-h6 q-ml-md"},Pt={key:0,class:"q-gutter-md"},Ct={class:"col text-h6"},At={class:"text-body2 text-grey q-ml-sm"},Tt={key:0,class:"q-gutter-md"},Qt={class:"column items-center"},xt={class:"text-subtitle2"},qt=c("span",{class:"text-grey"},"\u5355\u4EF7(\u8FD1\u4F3C\u503C)",-1),Dt={class:"column items-center"},$t={class:"text-subtitle2"},Vt=c("span",{class:"text-grey"},"\u6570\u91CF(\u8FD1\u4F3C\u503C)",-1),It={class:"column items-center"},Et={class:"text-subtitle2"},Lt=c("span",{class:"text-grey"},"\u603B\u989D(\u8FD1\u4F3C\u503C)",-1),Bt={class:"text-h6"},Nt={class:"flex justify-between"},Ut={class:"column items-center"},jt={class:"text-subtitle2"},Mt=c("span",{class:"text-grey"},"\u5355\u4EF7",-1),zt={class:"column items-center"},Ft={class:"text-subtitle2"},Gt=c("span",{class:"text-grey"},"\u6570\u91CF",-1),Rt={class:"column items-center"},Kt={class:"text-subtitle2"},Ot=c("span",{class:"text-grey"},"\u603B\u989D",-1),Wt=c("span",{class:"text-h6"},"\u6807\u7684",-1),Xt=c("span",{class:"text-h6"},"\u4EA4\u6613",-1);function Yt(e,s,m,l,u,t){const a=J("AddStock"),f=J("AddTransaction");return _(),E(st,{style:{"padding-top":"40px"}},{default:d(()=>[c("div",kt,[c("div",St,[o(Le,null,{default:d(()=>[o(be,{src:e.user.avatar},null,8,["src"])]),_:1}),c("span",wt,y(e.user.nickname),1)]),e.isLogin?(_(),C("div",Pt,[o(P,{flat:"",dense:"",round:"",icon:"add",onClick:s[0]||(s[0]=n=>e.onEditStock({}))})])):ee("",!0)]),o(ft,{modelValue:e.activeTab,"onUpdate:modelValue":s[2]||(s[2]=n=>e.activeTab=n)},{default:d(()=>[o(ie,{name:"sticks"},{default:d(()=>[o(Oe,null,{default:d(()=>[(_(!0),C(I,null,M(e.stocks,n=>(_(),E(Ke,{key:n.id,to:`/p/stocks/${n.id}/transactions`},{default:d(()=>[o(Re,null,{default:d(()=>[o(te,{class:"row"},{default:d(()=>[c("div",Ct,[c("span",null,y(n.name),1),c("span",At,y(n.code),1)]),e.isLogin?(_(),C("div",Tt,[o(P,{flat:"",dense:"",round:"",icon:"add",onClick:z(r=>e.onAddTransaction(n),["prevent"])},null,8,["onClick"]),o(P,{flat:"",dense:"",round:"",icon:"edit",onClick:z(r=>e.onEditStock(n),["prevent"])},null,8,["onClick"]),o(P,{color:"negative",flat:"",dense:"",round:"",icon:"delete",onClick:s[1]||(s[1]=z(()=>{},["prevent"]))},{default:d(()=>[o(Me,null,{default:d(()=>[o(me,null,{default:d(()=>[o(pe,null,{default:d(()=>[G(" \u4F60\u771F\u7684\u8981\u5220\u9664\u6B64\u4EA4\u6613\u5417\uFF1F ")]),_:1}),o(Be),o(Ne,{align:"right"},{default:d(()=>[o(P,{flat:"",color:"negative",label:"\u786E\u8BA4\u5220\u9664",onClick:r=>e.onDeleteStock(n.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)])):ee("",!0)]),_:2},1024),o(te,{class:"flex justify-between"},{default:d(()=>[c("div",Qt,[c("span",xt,y(n.price),1),qt]),c("div",Dt,[c("span",$t,y(n.quantity),1),Vt]),c("div",It,[c("span",Et,y(n.amount),1),Lt])]),_:2},1024)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:1})]),_:1}),o(ie,{name:"transactions"},{default:d(()=>[o(Xe,{class:"q-px-md"},{default:d(()=>[(_(!0),C(I,null,M(e.transactionGroups,n=>(_(),C(I,{key:n.date},[o(ne,{heading:""},{default:d(()=>[c("span",Bt,y(n.date),1)]),_:2},1024),(_(!0),C(I,null,M(n.transactions,r=>(_(),E(ne,{key:r.id,color:r.direction?"red":"green"},{title:d(()=>[G(y(r.name)+" - "+y(r.code),1)]),default:d(()=>[c("div",Nt,[c("div",Ut,[c("span",jt,y(r.price),1),Mt]),c("div",zt,[c("span",Ft,y(r.quantity),1),Gt]),c("div",Rt,[c("span",Kt,y(r.amount),1),Ot])])]),_:2},1032,["color"]))),128))],64))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(vt,{position:"top",offset:[0,0]},{default:d(()=>[o(Je,{modelValue:e.activeTab,"onUpdate:modelValue":s[3]||(s[3]=n=>e.activeTab=n),dense:"",align:"justify",class:"window-width bg-white text-orange shadow-1"},{default:d(()=>[o(re,{name:"sticks"},{default:d(()=>[Wt]),_:1}),o(re,{name:"transactions"},{default:d(()=>[Xt]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(a,{show:e.stockAddShow,"onUpdate:show":s[4]||(s[4]=n=>e.stockAddShow=n),data:e.stockAddData,onConfirm:e.loadData},null,8,["show","data","onConfirm"]),o(f,{show:e.transactionAddShow,"onUpdate:show":s[5]||(s[5]=n=>e.transactionAddShow=n),data:e.transactionAddData,onConfirm:e.loadData},null,8,["show","data","onConfirm"])]),_:1})}var ps=ce(_t,[["render",Yt]]);export{ps as default};
